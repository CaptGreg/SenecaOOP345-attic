<!DOCTYPE html>
<!--[if IE 8]><html lang="en" dir="ltr" class="ie8"><![endif]-->
<!--[if IE 9]><html lang="en" dir="ltr" class="ie9"><![endif]-->
<!--[if gt IE 9]><!-->
<html dir="ltr" class="js no-touch localstorage sessionstorage contenteditable use-opacity-transitions" lang="en"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Disqus Comments</title>

    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <style>
        .alert--warning {
            border-radius: 3px;
            padding: 10px 15px;
            margin-bottom: 10px;
            background-color: #FFE070;
            color: #A47703;
        }

        .alert--warning a,
        .alert--warning a:hover,
        .alert--warning strong {
            color: #A47703;
            font-weight: bold;
        }

        .alert--error p,
        .alert--warning p {
            margin-top: 5px;
            margin-bottom: 5px;
        }
        
        </style>
    
    <style>
        
        html {
            overflow: hidden;
        }
        

        #error {
            display: none;
        }

        .clearfix:after {
            content: "";
            display: block;
            height: 0;
            clear: both;
            visibility: hidden;
        }

        
    </style>

<script src="a_data/cbgapi.loaded_0" async=""></script><script crossorigin="anonymous" id="bootstrap-script" data-app="lounge" src="a_data/lounge_002.js"></script><meta http-equiv="Content-Security-Policy" content="script-src https:;"><link rel="stylesheet" href="a_data/lounge.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="lounge/main" src="a_data/lounge.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="remote/config" src="a_data/config.js"></script><style id="css_1504882060115"></style><!-- base href="https://disqus.com/embed/comments/?base=default&f=roar11-com&t_u=http%3A%2F%2Froar11.com%2F2016%2F01%2Fa-platform-independent-thread-pool-using-c14%2F&t_d=A%20Platform-Independent%20Thread%20Pool%20Using%20C%2B%2B14%0A&t_t=A%20Platform-Independent%20Thread%20Pool%20Using%20C%2B%2B14%0A&s_o=default" --><link rel="stylesheet" href="a_data/discovery.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="ga" src="a_data/ga.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="discovery/main" src="a_data/discovery.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="fb" src="a_data/sdk.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="gapi" src="a_data/api.js" gapi_processed="true"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}.fb_link img{border:none}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_reset .fb_dialog_legacy{overflow:visible}.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}.fb_dialog_content{background:#fff;color:#333}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_loader{background-color:#f6f7f9;border:1px solid #606060;font-size:24px;padding:20px}.fb_dialog_top_left,.fb_dialog_top_right,.fb_dialog_bottom_left,.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}.fb_dialog_top_left{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}.fb_dialog_top_right{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}.fb_dialog_bottom_left{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}.fb_dialog_bottom_right{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}.fb_dialog_vert_left,.fb_dialog_vert_right,.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}.fb_dialog_vert_left,.fb_dialog_vert_right{width:10px;height:100%}.fb_dialog_vert_left{margin-left:-10px}.fb_dialog_vert_right{right:0;margin-right:-10px}.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{width:100%;height:10px}.fb_dialog_horiz_top{margin-top:-10px}.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{width:auto;height:auto;min-height:initial;min-width:initial;background:none}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{color:#fff;display:block;padding-top:20px;clear:both;font-size:18px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;bottom:0;left:0;right:0;top:0;width:100%;min-height:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6), color-stop(.5, #355492), to(#2A4887));border:1px solid #29487d;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset, rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f6f7f9;border:1px solid #555;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-repeat:no-repeat;background-position:50% 50%;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_hide_iframes iframe{position:relative;left:-10000px}.fb_iframe_widget_loader{position:relative;display:inline-block}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}.fb_iframe_widget_loader .FB_Loader{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}</style></head>
<body>
    

    
    <div id="error" class="alert--error">
        <p>We were unable to load Disqus. If you are a moderator please see our <a href="https://docs.disqus.com/help/83/"> troubleshooting guide</a>. </p>
    </div>

    
    <script type="text/json" id="disqus-forumData">{"session":{"canModerate":false,"audienceSyncVerified":false,"mustVerify":false,"canReply":true,"mustVerifyEmail":false},"forum":{"founder":"252193001","twitterName":null,"commentsLinkOne":"1 Comment","guidelines":null,"favicon":{"permalink":"https://disqus.com/api/forums/favicons/roar11-com.jpg","cache":"//a.disquscdn.com/1504041135/images/favicon-default.png"},"commentsLinkZero":"0 Comments","disableDisqusBranding":false,"daysAlive":0,"createdAt":"2017-05-22T18:00:55.596970","category":"Tech","raw_guidelines":null,"colorScheme":"auto","id":"roar11-com","installCompleted":true,"commentPolicyText":null,"channel":null,"sort":1,"description":null,"moderatorBadgeText":"","raw_description":null,"language":"en","adsReviewStatus":0,"pk":"5140007","forumCategory":{"date_added":"2016-01-28T01:54:31","id":8,"name":"Tech"},"permissions":{},"commentPolicyLink":null,"name":"roar11.com","commentsLinkMultiple":"{num} Comments","settings":{"adsDRNativeEnabled":false,"disable3rdPartyTrackers":false,"adsVideoEnabled":false,"adsProductVideoEnabled":false,"adsPositionTopEnabled":false,"ssoRequired":false,"unapproveLinks":false,"adsEnabled":false,"adsProductLinksThumbnailsEnabled":false,"hasCustomAvatar":false,"organicDiscoveryEnabled":true,"allowMedia":true,"adsProductDisplayEnabled":false,"adsProductLinksEnabled":false,"linkAffiliationEnabled":true,"allowAnonPost":false,"adsProductStoriesEnabled":false,"adultContent":false,"allowAnonVotes":false,"mustVerify":true,"mustVerifyEmail":true,"audienceSyncEnabled":false,"mediaembedEnabled":true,"adsPositionBottomEnabled":false,"discoveryLocked":false,"validateAllPosts":false,"adsSettingsLocked":false,"isVIP":false,"adsPositionInthreadEnabled":false},"organizationId":3879646,"typeface":"auto","url":"http://roar11.com/","daysThreadAlive":0,"avatar":{"small":{"permalink":"https://disqus.com/api/forums/avatars/roar11-com.jpg?size=32","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"https://disqus.com/api/forums/avatars/roar11-com.jpg?size=92","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"}},"signedUrl":"http://disq.us/?url=http%3A%2F%2Froar11.com%2F&key=FnARgO9LHBf-hAUY4tfDsA"}}</script>

    <script type="text/json" id="disqus-threadData">{"cursor":{"hasPrev":false,"prev":null,"total":15,"hasNext":false,"next":"1:0:0"},"code":0,"response":{"lastModified":1495490701,"posts":[{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>Nicely done\u003c/p>\u003cp>slight error - probably a typo - coz it wont work without it - you have\u003c/p>\u003cp>m_threads.emplace_back(&amp;ThreadPool::worker, this);\u003c/p>\u003cp>when I think you mean\u003c/p>\u003cp>m_threads.emplace_back(std::thread(&amp;ThreadPool::worker), this);\u003c/p>\u003cp>it runs on only one thread as written\u003c/p>\u003cp>Also another typo you are missing a &gt;  after #include &lt;utility    in the #include list of the thread pool.\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"brenton","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"","isAnonymous":true},"media":[],"id":"3319579997","isDeletedByAuthor":false,"createdAt":"2016-05-21T02:43:40","parent":null,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"Nicely done\n\nslight error - probably a typo - coz it wont work without it - you have\n\nm_threads.emplace_back(&ThreadPool::worker, this);\n\nwhen I think you mean\n\nm_threads.emplace_back(std::thread(&ThreadPool::worker), this);\n\nit runs on only one thread as written \n\nAlso another typo you are missing a &#62;  after #include &#60;utility    in the #include list of the thread pool.","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":0,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>Thanks for bringing the missing &gt; to my attention.  I've fixed it in the post.\u003c/p>\u003cp>I'm able to use emplace_back as shown without problem.  When using std::vector's push_back function the way you wrote it would be required, but emplace_back can directly take constructor arguments and forward them to the vector's type.  So calling emplace_back as done above should be suitable and should create a new element in place with the worker function and a pointer to 'this'.  I'm using Visual Studio 2015, in case maybe it's an environment issue you're seeing.  Hope that helps.\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"WillP","url":"http://www.roar11.com/","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"http://disq.us/?url=http%3A%2F%2Fwww.roar11.com%2F&key=SVsUHliJ3AxZgzXUNBkJuQ","isAnonymous":true},"media":[],"id":"3319580018","isDeletedByAuthor":false,"createdAt":"2016-05-21T02:56:18","parent":3319579997,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"Thanks for bringing the missing > to my attention.  I've fixed it in the post.\n\nI'm able to use emplace_back as shown without problem.  When using std::vector's push_back function the way you wrote it would be required, but emplace_back can directly take constructor arguments and forward them to the vector's type.  So calling emplace_back as done above should be suitable and should create a new element in place with the worker function and a pointer to 'this'.  I'm using Visual Studio 2015, in case maybe it's an environment issue you're seeing.  Hope that helps.","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":1,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>My bad - I have a glitch somewhere else. the emplace back does seem to work\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"brenton","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"","isAnonymous":true},"media":[],"id":"3319580019","isDeletedByAuthor":false,"createdAt":"2016-05-21T07:58:33","parent":3319579997,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"My bad - I have a glitch somewhere else. the emplace back does seem to work","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":1,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>Thanks for sharing this code, it's a good example of one approach to write a task based system.\u003c/p>\u003cp>I have two questions:\u003cbr>1. How would you explain the extra 5 milliseconds spend on the tasks? I have changed each task to a 100 millisecond sleep and spawned 210 of them. The total execution time then is roughly 3.019 seconds, which translates into a 19 milliseconds overhead. Is this caused by context switching? How would you improve this?\u003cbr>2. I've tried to convert the code to make it compatible with c++11 (Visual Studio 2013). It (almost) compiled when I provided explicit return types (using \"-&gt;\" notation) and writing my own move constructors. It only complained about the arguments passed to the submitJob() function. Do you think there is a viable way to rewrite the code for C++11? Or does that require a lot of template magic or ugly code?\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"Cowlumbus","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"","isAnonymous":true},"media":[],"id":"3319579994","isDeletedByAuthor":false,"createdAt":"2016-06-11T18:14:27","parent":null,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"Thanks for sharing this code, it's a good example of one approach to write a task based system. \n\nI have two questions:\n1. How would you explain the extra 5 milliseconds spend on the tasks? I have changed each task to a 100 millisecond sleep and spawned 210 of them. The total execution time then is roughly 3.019 seconds, which translates into a 19 milliseconds overhead. Is this caused by context switching? How would you improve this?\n2. I've tried to convert the code to make it compatible with c++11 (Visual Studio 2013). It (almost) compiled when I provided explicit return types (using \"-&#62;\" notation) and writing my own move constructors. It only complained about the arguments passed to the submitJob() function. Do you think there is a viable way to rewrite the code for C++11? Or does that require a lot of template magic or ugly code?","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":0,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>After a bit of profiling, I think I can answer the first question myself:\u003c/p>\u003cp>* Most of the extra milliseconds comes from the fact that sleep_for() does not wake up the thread exactly after the specified amount of (milli)seconds. \u003cbr>* There is also a tiny bit of overhead caused by the mutexes.\u003cbr>* After reading up on context switches, I don't think they contribute much to the additional overhead.\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"Cowlumbus","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"","isAnonymous":true},"media":[],"id":"3319580021","isDeletedByAuthor":false,"createdAt":"2016-06-13T14:11:42","parent":3319579994,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"After a bit of profiling, I think I can answer the first question myself:\n\n* Most of the extra milliseconds comes from the fact that sleep_for() does not wake up the thread exactly after the specified amount of (milli)seconds. \n* There is also a tiny bit of overhead caused by the mutexes.\n* After reading up on context switches, I don't think they contribute much to the additional overhead.","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":1,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>Hey,\u003c/p>\u003cp>Good to see you've done some profiling already.  Yep, std::this_thread::sleep_for is specified to block the executing thread for \"at least\" the time specified.  Usually the scheduler will do a decent job waking up a sleeping thread when the time is up, but you can never be exactly certain.\u003c/p>\u003cp>Yes, using mutexes is another potential choke point in this implementation.  There are a few resources online that talk about lock-free, work-stealing queues that aim to alleviate this, but they can be difficult to get right, and I wanted to first make sure I had a reliable implementation, even if it isn't absolutely as fast as possible.\u003c/p>\u003cp>In the example from the post, context switching should be minimal since I'm not oversaturating my physical cores, but in your case it could add to the execution time since several tasks could be contending for resources on the same core.\u003c/p>\u003cp>Dynamic memory allocation is another potential slowdown in the implementation from the post.  If you look in the ThreadPool.submit function, you'll see make_unique being called on the packaged task wrappers.  A potentially better solution would be to use a pre-allocated memory pool to fetch and return chunks of memory from as they're needed, but that was beyond the scope of this article.  In a production real-time application, this is a route I would explore further, especially as the number of tasks being submitted grew.\u003c/p>\u003cp>All of these items are trade-offs between complexity and performance gains.  For the application I'm working on, I have 3 large \"main\" tasks that run constantly (divvying up work inside frames to render) and the costs of the dynamic allocations and mutex uses pale in comparison to the performance improvements on CPU-bound scenes.  Long-running background tasks such as loading new textures in, etc., don't bother the workflow, and the main tasks can even spawn off sub-tasks pretty efficiently and still be a net gain for performance.\u003c/p>\u003cp>As with anything else - you have to profile and find the best solution for your project. :)\u003c/p>\u003cp>Edit:  As far as the being C++14-specific stuff - the expanded use of 'auto' for return type deduction is a big help in keeping the implementation clean and easy to read.  I feel like template magic could get you most of the way there, but I haven't tried going that route.  (Also, make_unique is technically a C++14 feature, but I think VS has had it since 2013 if I recall correctly.)\u003c/p>\u003cp>-Will\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"WillP","url":"http://www.roar11.com/","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"http://disq.us/?url=http%3A%2F%2Fwww.roar11.com%2F&key=SVsUHliJ3AxZgzXUNBkJuQ","isAnonymous":true},"media":[],"id":"3319580154","isDeletedByAuthor":false,"createdAt":"2016-06-14T03:53:16","parent":3319580021,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"Hey,\n\nGood to see you've done some profiling already.  Yep, std::this_thread::sleep_for is specified to block the executing thread for \"at least\" the time specified.  Usually the scheduler will do a decent job waking up a sleeping thread when the time is up, but you can never be exactly certain.\n\nYes, using mutexes is another potential choke point in this implementation.  There are a few resources online that talk about lock-free, work-stealing queues that aim to alleviate this, but they can be difficult to get right, and I wanted to first make sure I had a reliable implementation, even if it isn't absolutely as fast as possible.\n\nIn the example from the post, context switching should be minimal since I'm not oversaturating my physical cores, but in your case it could add to the execution time since several tasks could be contending for resources on the same core.\n\nDynamic memory allocation is another potential slowdown in the implementation from the post.  If you look in the ThreadPool.submit function, you'll see make_unique being called on the packaged task wrappers.  A potentially better solution would be to use a pre-allocated memory pool to fetch and return chunks of memory from as they're needed, but that was beyond the scope of this article.  In a production real-time application, this is a route I would explore further, especially as the number of tasks being submitted grew.\n\nAll of these items are trade-offs between complexity and performance gains.  For the application I'm working on, I have 3 large \"main\" tasks that run constantly (divvying up work inside frames to render) and the costs of the dynamic allocations and mutex uses pale in comparison to the performance improvements on CPU-bound scenes.  Long-running background tasks such as loading new textures in, etc., don't bother the workflow, and the main tasks can even spawn off sub-tasks pretty efficiently and still be a net gain for performance.\n\nAs with anything else - you have to profile and find the best solution for your project. :)\n\nEdit:  As far as the being C++14-specific stuff - the expanded use of 'auto' for return type deduction is a big help in keeping the implementation clean and easy to read.  I feel like template magic could get you most of the way there, but I haven't tried going that route.  (Also, make_unique is technically a C++14 feature, but I think VS has had it since 2013 if I recall correctly.)\n\n-Will","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":2,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>Thank you for the information you provided in this post. I would like to mention that thread.join() is going to \u003cbr>hang the application exist on VS2013 because of this bug \u003cbr>\u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fconnect.microsoft.com%2FVisualStudio%2Ffeedback%2Fdetails%2F747145%3ADTqnF-IcYgrhuFgrq13HokRQ_hg&amp;cuid=5140007\" rel=\"nofollow noopener\">https://connect.microsoft.c...\u003c/a>\u003c/p>\u003cp>Apparently, thread::join() is being called after the main() function exists and this tries to run a mutex initialization\u003cbr>code after the main function ends.\u003cbr>a workaround as suggested on the provided link is to call windows API \"_Cnd_do_broadcast_at_thread_exit()\"\u003cbr>before creating any threads. This will ensure that mutexes are created before any object tries to access them \u003cbr>and also ensure that mutexes will live until the last moment of application life.\u003c/p>\u003cp>Cheers..Samir\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"Mohamed Samir","url":"http://www.titan-interactive.com/","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"http://disq.us/?url=http%3A%2F%2Fwww.titan-interactive.com%2F&key=QvfO8p43jWUvPDz8Qp7JDQ","isAnonymous":true},"media":[],"id":"3319579991","isDeletedByAuthor":false,"createdAt":"2016-08-23T13:55:26","parent":null,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"Thank you for the information you provided in this post. I would like to mention that thread.join() is going to \nhang the application exist on VS2013 because of this bug \nhttps://connect.microsoft.com/VisualStudio/feedback/details/747145\n\nApparently, thread::join() is being called after the main() function exists and this tries to run a mutex initialization\ncode after the main function ends.\na workaround as suggested on the provided link is to call windows API \"_Cnd_do_broadcast_at_thread_exit()\"\nbefore creating any threads. This will ensure that mutexes are created before any object tries to access them \nand also ensure that mutexes will live until the last moment of application life.\n\nCheers..Samir","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":0,"points":0,"moderationLabels":["anonymous","links"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>Thank you for the hard work on this!\u003c/p>\u003cp>How would I move a unique_ptr into this queue?\u003c/p>\u003cp>I tried the following:\u003c/p>\u003cp>auto taskFuture = DefaultThreadPool::submitJob(\u003cbr>\t[](int _n, unique_ptr _message)\u003cbr>{\u003cbr>\tdoTask(_n, move(_message));\u003cbr>}, n, move(message));\u003c/p>\u003cp>But I get:\u003c/p>\u003cp>    Error C2672: 'std::invoke': no matching overloaded function found (1)\u003c/p>\u003cp>Do you have any suggestions?\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"Boris","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"","isAnonymous":true},"media":[],"id":"3319579999","isDeletedByAuthor":false,"createdAt":"2016-09-07T20:54:56","parent":null,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"Thank you for the hard work on this!\n\nHow would I move a unique_ptr into this queue? \n\nI tried the following:\n\nauto taskFuture = DefaultThreadPool::submitJob(\n\t[](int _n, unique_ptr _message)\n{\n\tdoTask(_n, move(_message));\n}, n, move(message));\n\nBut I get:\n\n    Error C2672: 'std::invoke': no matching overloaded function found (1)\n\nDo you have any suggestions?","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":0,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>Hi,\u003c/p>\u003cp>An unfortunate result of using std::bind is that movable-only types aren't able to be passed easily if you're looking to transfer ownership (otherwise a const reference would suffice).\u003c/p>\u003cp>A sloppy way to do get around the limitation would be to change the lambda to take a raw pointer of your type and call release() on the original when submitting the task.  Then immediately wrap it back up in a unique_ptr inside the lambda body.  Again - sloppy and ugly, but it technically works, and from the body of the lambda you could move it elsewhere (your doTask function, for example).\u003c/p>\u003cp>C++ 17's std::apply (\u003ca href=\"http://disq.us/url?url=http%3A%2F%2Fen.cppreference.com%2Fw%2Fcpp%2Futility%2Fapply%29%3AIQ4M2K2YBinP_mUpuU-d0NLga_E&amp;cuid=5140007\" rel=\"nofollow noopener\">http://en.cppreference.com/...\u003c/a> will likely be a better fit in the future, and it should allow move-only types to be used as expected.\u003c/p>\u003cp>Another potential solution you could explore is presented here:  \u003ca href=\"http://disq.us/url?url=http%3A%2F%2Ftalesofcpp.fusionfenix.com%2Fpost-14%2Ftrue-story-moving-past-bind%3AvNHLPcaATYRw0LooscwHhA8NOFs&amp;cuid=5140007\" rel=\"nofollow noopener\">http://talesofcpp.fusionfen...\u003c/a>\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"WillP","url":"http://www.roar11.com/","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"http://disq.us/?url=http%3A%2F%2Fwww.roar11.com%2F&key=SVsUHliJ3AxZgzXUNBkJuQ","isAnonymous":true},"media":[],"id":"3319580022","isDeletedByAuthor":false,"createdAt":"2016-09-13T22:31:14","parent":3319579999,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"Hi,\n\nAn unfortunate result of using std::bind is that movable-only types aren't able to be passed easily if you're looking to transfer ownership (otherwise a const reference would suffice).\n\nA sloppy way to do get around the limitation would be to change the lambda to take a raw pointer of your type and call release() on the original when submitting the task.  Then immediately wrap it back up in a unique_ptr inside the lambda body.  Again - sloppy and ugly, but it technically works, and from the body of the lambda you could move it elsewhere (your doTask function, for example).\n\nC++ 17's std::apply (http://en.cppreference.com/w/cpp/utility/apply) will likely be a better fit in the future, and it should allow move-only types to be used as expected.\n\nAnother potential solution you could explore is presented here:  http://talesofcpp.fusionfenix.com/post-14/true-story-moving-past-bind","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":1,"points":0,"moderationLabels":["anonymous","links"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>Hi,\u003c/p>\u003cp>I am having trouble using your example. I want to use it to do a single consumer thread that takes an input and process it and send an notification or a result to another thread.\u003c/p>\u003cp>Here is my code :\u003cbr>void Notify(int a){\u003cbr>    std::cout &lt;&lt; \"Hello again\" &lt;&lt; a &lt;&lt; std::endl;\u003cbr>}\u003c/p>\u003cp>class Tests{\u003cbr>public:\u003cbr>    void run(int a){\u003cbr>        std::this_thread::sleep_for(std::chrono::seconds(1));\u003cbr>        std::cout &lt;&lt; \"Hello \" &lt;&lt; a &lt;&lt; std::endl;\u003c/p>\u003cp>        DefaultThreadPool::submitJob([](int b)\u003cbr>        {\u003cbr>            Notify(b);\u003cbr>        }, a);\u003cbr>    }\u003cbr>};\u003c/p>\u003cp>int main( int argc, char* argv[] )\u003cbr>{\u003cbr>    auto i{0};\u003cbr>    Tests tests;\u003c/p>\u003cp>    while(true){\u003cbr>        DefaultThreadPool::submitJob([](Tests&amp; obj, int a)\u003cbr>        {\u003cbr>            \u003ca href=\"http://disq.us/url?url=http%3A%2F%2Fobj.run%3AhX2u5HPXtkapowFaWvOJXYHBlis&amp;cuid=5140007\" rel=\"nofollow noopener\">obj.run\u003c/a>(a);\u003cbr>        },std::ref(tests), i);\u003c/p>\u003cp>        i++;\u003cbr>    }\u003cbr>    return 0;\u003cbr>}\u003c/p>\u003cp>I don't know if i am doing it right. It's like a cascading queue. But when I try to build it I have this error :\u003cbr>In file included from /src/\u003ca href=\"http://disq.us/url?url=http%3A%2F%2Fmain_test.cc%3A96OOehJ3w4trnIhFOpvIFurf33I&amp;cuid=5140007\" rel=\"nofollow noopener\">main_test.cc\u003c/a>:2:0:\u003cbr>/src/ThreadPool.h: In function 'auto DefaultThreadPool::submitJob(Func&amp;&amp;, Args&amp;&amp; ...)':\u003cbr>/src/ThreadPool.h:222:30: error: there are no arguments to 'getThreadPool' that depend on a template parameter, so a declaration of 'getThreadPool' must be available [-fpermissive]\u003cbr>         return getThreadPool().submit(std::forward(func), std::forward(args)...);\u003cbr>                              ^\u003cbr>/src/ThreadPool.h:222:30: note: (if you use '-fpermissive', G++ will accept your code, but allowing the use of an undeclared name is deprecated)\u003cbr>src/CMakeFiles/test_thread.dir/build.make:62: recipe for target 'src/CMakeFiles/test_thread.dir/main_test.cc.o' failed\u003c/p>\u003cp>I am using G++ 5.4\u003c/p>\u003cp>Thanks for your help.\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"Aust","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"","isAnonymous":true},"media":[],"id":"3319579993","isDeletedByAuthor":false,"createdAt":"2016-11-30T17:48:02","parent":null,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"Hi,\n\nI am having trouble using your example. I want to use it to do a single consumer thread that takes an input and process it and send an notification or a result to another thread.\n\nHere is my code :\nvoid Notify(int a){\n    std::cout \u003c\u003c \"Hello again\" \u003c\u003c a \u003c\u003c std::endl;\n}\n\nclass Tests{\npublic:\n    void run(int a){\n        std::this_thread::sleep_for(std::chrono::seconds(1));\n        std::cout \u003c\u003c \"Hello \" \u003c\u003c a \u003c\u003c std::endl;\n\n        DefaultThreadPool::submitJob([](int b)\n        {\n            Notify(b);\n        }, a);\n    }\n};\n\n\nint main( int argc, char* argv[] )\n{\n    auto i{0};\n    Tests tests;\n\n    while(true){\n        DefaultThreadPool::submitJob([](Tests& obj, int a)\n        {\n            obj.run(a);\n        },std::ref(tests), i);\n\n        i++;\n    }\n    return 0;\n}\n\nI don&#039t know if i am doing it right. It&#039s like a cascading queue. But when I try to build it I have this error :\nIn file included from /src/main_test.cc:2:0:\n/src/ThreadPool.h: In function 'auto DefaultThreadPool::submitJob(Func&&, Args&& ...)':\n/src/ThreadPool.h:222:30: error: there are no arguments to 'getThreadPool' that depend on a template parameter, so a declaration of 'getThreadPool' must be available [-fpermissive]\n         return getThreadPool().submit(std::forward(func), std::forward(args)...);\n                              ^\n/src/ThreadPool.h:222:30: note: (if you use '-fpermissive', G++ will accept your code, but allowing the use of an undeclared name is deprecated)\nsrc/CMakeFiles/test_thread.dir/build.make:62: recipe for target 'src/CMakeFiles/test_thread.dir/main_test.cc.o' failed\n\nI am using G++ 5.4\n\nThanks for your help.","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":0,"points":0,"moderationLabels":["anonymous","links"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>Interesting, I'm running your example copy/pasted in VS2015 with no errors or warnings.  Are you enabling the c++14 flag for g++?  (g++-5.4.0 -std=c++14 filename.cpp)\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"WillP","url":"http://www.roar11.com/","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"http://disq.us/?url=http%3A%2F%2Fwww.roar11.com%2F&key=SVsUHliJ3AxZgzXUNBkJuQ","isAnonymous":true},"media":[],"id":"3319580027","isDeletedByAuthor":false,"createdAt":"2016-12-07T16:10:28","parent":3319579993,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"Interesting, I'm running your example copy/pasted in VS2015 with no errors or warnings.  Are you enabling the c++14 flag for g++?  (g++-5.4.0 -std=c++14 filename.cpp)","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":1,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>Hey WillP,\u003c/p>\u003cp>Thanks for the great threading article! I've started to have a play around with the code and I've run into an issue. If I submit a task from within a method and then try and fall out of that method whilst the long lived background task is underway then I get a hang at the end of the method.\u003c/p>\u003cp>This is caused by the m_future.get() line in the destructor which blocks the main (calling) thread.\u003c/p>\u003cp>Is this down to the fact that the future was created in the method and therefore the destructor gets called as the method goes out of scope which in turn blocks (because the future is still in use)? If so, is there any way I can work around this?\u003c/p>\u003cp>Thanks again!\u003c/p>\u003cp>Adam\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"Adam","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"","isAnonymous":true},"media":[],"id":"3319579990","isDeletedByAuthor":false,"createdAt":"2016-12-03T17:03:07","parent":null,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"Hey WillP,\n\nThanks for the great threading article! I've started to have a play around with the code and I've run into an issue. If I submit a task from within a method and then try and fall out of that method whilst the long lived background task is underway then I get a hang at the end of the method.\n\nThis is caused by the m_future.get() line in the destructor which blocks the main (calling) thread.\n\nIs this down to the fact that the future was created in the method and therefore the destructor gets called as the method goes out of scope which in turn blocks (because the future is still in use)? If so, is there any way I can work around this?\n\nThanks again!\n\nAdam","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":0,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>Hey Adam,\u003cbr>Yep, that was a design decision based on how I'm using the thread pool in my specific application.  If you don't want it to block when the future goes out of scope, you have a few options.  You can return the future to the calling method, store it somewhere else (std::move), or you could flesh the TaskFuture class out a little more and add a detach() method that could set a flag to check in the destructor before calling .get().\u003cbr>-Will\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"WillP","url":"http://www.roar11.com/","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"http://disq.us/?url=http%3A%2F%2Fwww.roar11.com%2F&key=SVsUHliJ3AxZgzXUNBkJuQ","isAnonymous":true},"media":[],"id":"3319580025","isDeletedByAuthor":false,"createdAt":"2016-12-07T16:17:31","parent":3319579990,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"Hey Adam,\nYep, that was a design decision based on how I'm using the thread pool in my specific application.  If you don't want it to block when the future goes out of scope, you have a few options.  You can return the future to the calling method, store it somewhere else (std::move), or you could flesh the TaskFuture class out a little more and add a detach() method that could set a flag to check in the destructor before calling .get().\n-Will","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":1,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>I have a slight bagaboo with your code &amp; example driver;  if your code is truly cross platform why not use a truly cross platform time keeping class. Rather than Timer, which is a windows-only class, use std::chrono for your time keeping methods. And in DefaultThreadPool::submitJob there is deprecated behavior; \"there are no arguments to 'getThreadPool' that depend on a template parameter, so a declaration of 'getThreadPool' must be available\", I bet this compiles fine on MSVC, right? MSVC is not a paragon of ISO/IEC 14882:2014 behavior. In fact, it varies from the draft standard in many respects, unfortunately.\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"interval","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"","isAnonymous":true},"media":[],"id":"3319579996","isDeletedByAuthor":false,"createdAt":"2017-05-07T18:51:51","parent":null,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"I have a slight bagaboo with your code &#38; example driver;  if your code is truly cross platform why not use a truly cross platform time keeping class. Rather than Timer, which is a windows-only class, use std::chrono for your time keeping methods. And in DefaultThreadPool::submitJob there is deprecated behavior; \"there are no arguments to 'getThreadPool' that depend on a template parameter, so a declaration of 'getThreadPool' must be available\", I bet this compiles fine on MSVC, right? MSVC is not a paragon of ISO/IEC 14882:2014 behavior. In fact, it varies from the draft standard in many respects, unfortunately.","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":0,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false},{"dislikes":0,"numReports":0,"likes":0,"message":"\u003cp>The Timer class is part of my project, not a MS thing (although they may have something named Timer, too).  I didn't specify details about it since it wasn't the focus of the article, but it's implemented using types found in the chrono header.  The tick function is:\u003cbr>[code language=\"cpp\"]\u003cbr>double Timer::tick(void)\u003cbr>{\u003cbr>\tm_currentTime = std::chrono::high_resolution_clock::now();\u003cbr>\tm_timeElapsed = (m_currentTime - m_lastTime).count() * m_timeScale;\u003cbr>\tm_lastTime = m_currentTime;\u003cbr>\treturn m_timeElapsed;\u003cbr>}\u003cbr>[/code]\u003c/p>\u003cp>Regarding the 'there are no arguments...' portion, there are two potential issues.  First, I should define getThreadPool before submitJob.  Second, the fully-qualified type name should be used, or there should be a 'using' directive before it.  For example,\u003cbr>[code language=\"cpp\"]\u003cbr>MyNamespace::DefaultThreadPool::submitJob...\u003cbr>[/code]\u003c/p>\u003cp>or\u003c/p>\u003cp>[code language=\"cpp\"]\u003cbr>using MyNamespace;\u003cbr>DefaultThreadPool::submitJob...\u003cbr>[/code]\u003c/p>\u003cp>I should have specified that in the example, but that portion was meant to be a very basic demonstration of usage and I got lazy on copy/pasting.  I've updated the code in the article to reflect these items.\u003c/p>","isSpam":false,"isHighlighted":false,"author":{"name":"WillP","url":"http://www.roar11.com/","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar32.png","cache":"//a.disquscdn.com/1504041135/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1504041135/images/noavatar92.png","cache":"//a.disquscdn.com/1504041135/images/noavatar92.png"},"signedUrl":"http://disq.us/?url=http%3A%2F%2Fwww.roar11.com%2F&key=SVsUHliJ3AxZgzXUNBkJuQ","isAnonymous":true},"media":[],"id":"3319580028","isDeletedByAuthor":false,"createdAt":"2017-05-07T22:29:11","parent":3319579996,"isApproved":true,"isDeleted":false,"isFlagged":false,"raw_message":"The Timer class is part of my project, not a MS thing (although they may have something named Timer, too).  I didn't specify details about it since it wasn't the focus of the article, but it's implemented using types found in the chrono header.  The tick function is:\n[code language=\"cpp\"]\ndouble Timer::tick(void)\n{\n\tm_currentTime = std::chrono::high_resolution_clock::now();\n\tm_timeElapsed = (m_currentTime - m_lastTime).count() * m_timeScale;\n\tm_lastTime = m_currentTime;\n\treturn m_timeElapsed;\n}\n[/code]\n\nRegarding the 'there are no arguments...' portion, there are two potential issues.  First, I should define getThreadPool before submitJob.  Second, the fully-qualified type name should be used, or there should be a 'using' directive before it.  For example,\n[code language=\"cpp\"]\nMyNamespace::DefaultThreadPool::submitJob...\n[/code]\n\nor\n\n[code language=\"cpp\"]\nusing MyNamespace;\nDefaultThreadPool::submitJob...\n[/code]\n\nI should have specified that in the example, but that portion was meant to be a very basic demonstration of usage and I got lazy on copy/pasting.  I've updated the code in the article to reflect these items.","canVote":false,"thread":"5841294932","forum":"roar11-com","depth":1,"points":0,"moderationLabels":["anonymous"],"isEdited":false,"sb":false}],"thread":{"feed":"https://roar11-com.disqus.com/a_platform_independent_thread_pool_using_c14/latest.rss","author":"252193001","dislikes":0,"likes":0,"message":"","isSpam":false,"createdAt":"2016-01-03T22:13:53","category":"6858752","clean_title":"A Platform-Independent Thread Pool Using C++14","id":"5841294932","signedLink":"http://disq.us/?url=http%3A%2F%2Froar11.com%2F2016%2F01%2Fa-platform-independent-thread-pool-using-c14%2F&key=gsS1DdiD4xE0STR6dtOc9g","isDeleted":false,"hasStreaming":false,"raw_message":"","isClosed":false,"link":"http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/","slug":"a_platform_independent_thread_pool_using_c14","forum":"roar11-com","identifiers":[],"posts":15,"moderators":[252193001],"validateAllPosts":false,"title":"A Platform-Independent Thread Pool Using C++14","highlightedPost":null}},"order":"asc"}</script>


    <div id="fixed-content"></div>


    
        
<script type="text/json" id="disqus-urls">{
    "root":"//disqus.com",
    "next":"https://c.disquscdn.com/next/current/embed"
}</script>

        
        <script>!function () {
            var d = document;
            var toH = d.head.appendChild.bind(d.head);

            var v = window.location.href.match(/[#&?]version=([0-9a-f]{32})/);
            var src = 'https://c.disquscdn.com/next/embed/lounge.load';
            if (v)
                src += '.' + v[1];
            src += '.js';

            var s = d.createElement('script');
            s.crossOrigin = 'anonymous';
            s.id = 'bootstrap-script';
            s.setAttribute('data-app', 'lounge');
            s.src = src;
            toH(s);

            var m = d.createElement('meta');
            m.setAttribute('http-equiv', 'Content-Security-Policy');
            m.setAttribute('content', "script-src https:;");
            toH(m);
        }();</script>
    


<script src="a_data/common.js"></script><div id="layout" data-tracking-area="layout"><div id="onboard" data-tracking-area="onboard"><div></div></div><div id="highlighted-post" data-tracking-area="highlighted" class="highlighted-post" style="display: none;"></div><div id="global-alert"></div><header id="main-nav" data-tracking-area="main-nav"><nav class="nav nav-primary"><ul><li class="nav-tab nav-tab--primary tab-conversation active" data-role="post-count"><a class="publisher-nav-color"><span class="comment-count">15 comments</span><span class="comment-count-placeholder">Comments</span></a></li><li class="nav-tab nav-tab--primary tab-community"><a href="https://disqus.com/home/forums/roar11-com/" class="publisher-nav-color" data-action="community-sidebar" data-forum="roar11-com" id="community-tab"><span class="community-name"><strong>roar11.com</strong></span><strong class="community-name-placeholder">Community</strong></a></li><li class="nav-tab nav-tab--primary dropdown user-menu" data-role="logout"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="dropdown-toggle-wrapper"><span>Login</span> </span> <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="#" data-action="auth:disqus">Disqus</a></li><li><a href="#" data-action="auth:facebook">Facebook</a></li><li><a href="#" data-action="auth:twitter">Twitter</a></li><li><a href="#" data-action="auth:google">Google</a></li></ul></li><li class="nav-tab nav-tab--primary notification-menu unread" data-role="notification-menu"><a href="https://disqus.com/home/inbox/" class="notification-container" data-action="home" data-home-path="home/inbox/"><span class="notification-icon icon-comment" aria-hidden="true"></span><span class="notification-count" data-role="notification-count">1</span></a></li></ul></nav></header><section id="conversation" data-role="main" data-tracking-area="main"><div class="nav nav-secondary" data-tracking-area="secondary-nav"><ul><li id="recommend-button" class="nav-tab nav-tab--secondary recommend dropdown"><div class="thread-likes"><div><a href="#" data-action="recommend" title="Recommend this discussion" class="dropdown-toggle "><span class="label label-default"><span class="recommend-icon icon-heart-empty"></span> Recommend</span><span class="label label-recommended"><span class="recommend-icon icon-heart"></span> Recommended</span> </a><ul class="dropdown-menu dropdown-menu--coachmark"><li><div><h2 class="coachmark__heading">Discussion Recommended!</h2><p class="coachmark__description">Recommending means this is a discussion worth sharing. It gets shared to your followers' Disqus feeds, and gives the creator kudos!</p></div> <a href="https://disqus.com/home/?utm_source=disqus_embed&amp;utm_content=recommend_btn" class="btn btn-primary coachmark__button" target="_blank">Find More Discussions</a></li></ul></div></div></li><li id="thread-share-menu" class="nav-tab nav-tab--secondary dropdown share-menu hidden-sm"><a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Share"><span class="icon-export"></span> <span class="label">Share</span></a><ul class="share-menu dropdown-menu"><li><div class="share-menu__label">Share this discussion on</div><ul><li class="twitter"><a data-action="share:twitter" href="#">Twitter</a></li><li class="facebook"><a data-action="share:facebook" href="#">Facebook</a></li></ul></li></ul></li><li data-role="post-sort" class="nav-tab nav-tab--secondary dropdown sorting pull-right"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Sort by Oldest<span class="caret"></span></a><ul class="dropdown-menu pull-right"><li class=""><a href="#" data-action="sort" data-sort="popular">Best<i aria-hidden="true" class="icon-checkmark"></i></a></li><li class=""><a href="#" data-action="sort" data-sort="desc">Newest<i aria-hidden="true" class="icon-checkmark"></i></a></li><li class="selected"><a href="#" data-action="sort" data-sort="asc">Oldest<i aria-hidden="true" class="icon-checkmark"></i></a></li></ul></li></ul></div><div id="posts"><div id="form" class="textarea-wrapper--top-level"><form class="reply"><div class="postbox"><div role="alert"></div><div class="avatar"><span class="user"><img data-role="user-avatar" src="a_data/noavatar92.png" alt="Avatar"></span></div><div class="textarea-wrapper" data-role="textarea" dir="auto"><div><span class="placeholder">Join the discussion</span><div class="textarea" tabindex="0" role="textbox" aria-multiline="true" data-role="editable" style="overflow: auto; overflow-wrap: break-word; max-height: 350px;" aria-label="Join the discussion" contenteditable="true"><p><br></p></div><div style="display: none;"><ul class="user-mention__list"><li class="header user-mention__header"><h5>in this conversation</h5></li></ul></div></div><div data-role="drag-drop-placeholder" class="media-drag-hover" style="display: none;"><div class="drag-text"> Drag and drop your images here to upload them.</div></div><div class="media-preview empty" data-role="media-preview"><ul data-role="media-progress-list"></ul>
<ul data-role="media-rich-list"></ul>
<div class="media-expanded empty" data-role="media-preview-expanded">
<img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-role="media-preview-expanded-image" alt="Media preview placeholder">
</div>
</div><div class="edit-alert" role="postbox-alert"></div><div class="post-actions"><ul class="wysiwyg"><li class="wysiwyg__item" data-role="media-uploader"><a href="#" tabindex="-1" data-action="attach" class="attach" title="Upload Images"><span>Attach</span></a>
<input data-role="media-upload" tabindex="-1" accept="image/*" type="file">
</li></ul></div></div><div data-role="login-form"><div><div><section class="auth-section logged-out"><div class="connect"><h6>Log in with</h6><ul data-role="login-menu" class="services login-buttons"><li class="auth-disqus"><button type="button" data-action="auth:disqus" title="Disqus" class="connect__button"><i class="icon-disqus"></i></button></li><li class="auth-facebook"><button type="button" data-action="auth:facebook" title="Facebook" class="connect__button"><i class="icon-facebook-circle"></i></button></li><li class="auth-twitter"><button type="button" data-action="auth:twitter" title="Twitter" class="connect__button"><i class="icon-twitter-circle"></i></button></li><li class="auth-google"><button type="button" data-action="auth:google" title="Google" class="connect__button"><i class="icon-google-plus-circle"></i></button></li></ul></div><div class="guest"><h6 class="guest-form-title"><span class="register-text"> or sign up with Disqus </span><span class="guest-text"> or pick a name </span></h6> <div class="help-tooltip__wrapper help-icon"><div id="rules" class="tooltip show help-tooltip"><h3 class="help-tooltip__heading">Disqus is a discussion network</h3><ul class="help-tooltip__list"><li><span>Disqus never moderates or censors. The rules on this community are its own.</span></li><li><span>Don't be a jerk or do anything illegal. Everything is easier that way.</span></li></ul><p class="clearfix"><a href="https://docs.disqus.com/kb/terms-and-policies/" class="btn btn-small help-tooltip__button" target="_blank">Read full terms and conditions</a></p></div></div><p class="input-wrapper"><input dir="auto" placeholder="Name" name="display_name" id="view57_display_name" maxlength="30" class="input--text" type="text"></p><div class="guest-details " data-role="guest-details"><p class="input-wrapper"><input dir="auto" placeholder="Email" name="email" id="view57_email" class="input--text" type="email"></p><p class="input-wrapper"><input dir="auto" class="register-text input--text" placeholder="Password" name="password" id="view57_password" type="password"></p><div class="acceptance-wrapper register-text">By signing up, you agree to the Disqus <a href="https://help.disqus.com/customer/portal/articles/1753105-basic-rules-for-disqus-powered-profiles-and-discussions" target="_blank">Basic Rules</a>, <a href="https://help.disqus.com/customer/portal/articles/466260-terms-of-service" target="_blank">Terms of Service</a>, and <a href="https://help.disqus.com/customer/portal/articles/466259-privacy-policy" target="_blank">Privacy Policy</a>.</div><div class="acceptance-wrapper guest-text">By posting, you agree to the Disqus <a href="https://help.disqus.com/customer/portal/articles/1753105-basic-rules-for-disqus-powered-profiles-and-discussions" target="_blank">Basic Rules</a>, <a href="https://help.disqus.com/customer/portal/articles/466260-terms-of-service" target="_blank">Terms of Service</a>, and <a href="https://help.disqus.com/customer/portal/articles/466259-privacy-policy" target="_blank">Privacy Policy</a>.</div><input name="author-guest" style="display: none;" type="checkbox"><div class="proceed" data-role="submit-btn-container"><button type="submit" class="proceed__button btn submit" aria-label="Next"><span class="icon-proceed"></span><div class="spinner"></div></button></div></div></div></section></div></div></div></div></form></div><button class="alert alert--realtime" style="display: none;" data-role="realtime-notification"></button><div id="no-posts" style="display: none;"></div><ul id="post-list" class="post-list"><li class="post" id="post-3319579997"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">brenton</span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579997" data-role="relative-time" class="time-ago" title="Friday, May 20, 2016 10:43 PM">a year ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Nicely done</p><p>slight error - probably a typo - coz it wont work without it - you have</p><p>m_threads.emplace_back(&amp;ThreadPool::worker, this);</p><p>when I think you mean</p><p>m_threads.emplace_back(std::thread(&amp;ThreadPool::worker), this);</p><p>it runs on only one thread as written</p><p>Also another typo you are missing a &gt;  after #include &lt;utility    in the #include list of the thread pool.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4bh"></li></ul></li><li class="realtime" data-role="realtime-notification:3319579997"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"><li class="post" id="post-3319580018"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">WillP</span><span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579997" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> brenton</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319580018" data-role="relative-time" class="time-ago" title="Friday, May 20, 2016 10:56 PM">a year ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thanks for bringing the missing &gt; to my attention.  I've fixed it in the post.</p><p>I'm
 able to use emplace_back as shown without problem.  When using 
std::vector's push_back function the way you wrote it would be required,
 but emplace_back can directly take constructor arguments and forward 
them to the vector's type.  So calling emplace_back as done above should
 be suitable and should create a new element in place with the worker 
function and a pointer to 'this'.  I'm using Visual Studio 2015, in case
 maybe it's an environment issue you're seeing.  Hope that helps.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4c2"></li></ul></li><li class="realtime" data-role="realtime-notification:3319580018"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"></ul></li><li class="post" id="post-3319580019"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">brenton</span><span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579997" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> brenton</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319580019" data-role="relative-time" class="time-ago" title="Saturday, May 21, 2016 3:58 AM">a year ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>My bad - I have a glitch somewhere else. the emplace back does seem to work</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4c3"></li></ul></li><li class="realtime" data-role="realtime-notification:3319580019"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"></ul></li></ul></li><li class="post" id="post-3319579994"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">Cowlumbus</span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579994" data-role="relative-time" class="time-ago" title="Saturday, June 11, 2016 2:14 PM">a year ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thanks for sharing this code, it's a good example of one approach to write a task based system.</p><p>I have two questions:<br>1.
 How would you explain the extra 5 milliseconds spend on the tasks? I 
have changed each task to a 100 millisecond sleep and spawned 210 of 
them. The total execution time then is roughly 3.019 seconds, which 
translates into a 19 milliseconds overhead. Is this caused by context 
switching? How would you improve this?<br>2. I've tried to convert the 
code to make it compatible with c++11 (Visual Studio 2013). It (almost) 
compiled when I provided explicit return types (using "-&gt;" notation) 
and writing my own move constructors. It only complained about the 
arguments passed to the submitJob() function. Do you think there is a 
viable way to rewrite the code for C++11? Or does that require a lot of 
template magic or ugly code?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4be"></li></ul></li><li class="realtime" data-role="realtime-notification:3319579994"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"><li class="post" id="post-3319580021"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">Cowlumbus</span><span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579994" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cowlumbus</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319580021" data-role="relative-time" class="time-ago" title="Monday, June 13, 2016 10:11 AM">a year ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>After a bit of profiling, I think I can answer the first question myself:</p><p>*
 Most of the extra milliseconds comes from the fact that sleep_for() 
does not wake up the thread exactly after the specified amount of 
(milli)seconds. <br>* There is also a tiny bit of overhead caused by the mutexes.<br>* After reading up on context switches, I don't think they contribute much to the additional overhead.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4c5"></li></ul></li><li class="realtime" data-role="realtime-notification:3319580021"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"><li class="post" id="post-3319580154"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">WillP</span><span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319580021" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cowlumbus</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319580154" data-role="relative-time" class="time-ago" title="Monday, June 13, 2016 11:53 PM">a year ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container" style="height: 374px;"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hey,</p><p>Good
 to see you've done some profiling already.  Yep, 
std::this_thread::sleep_for is specified to block the executing thread 
for "at least" the time specified.  Usually the scheduler will do a 
decent job waking up a sleeping thread when the time is up, but you can 
never be exactly certain.</p><p>Yes, using mutexes is another potential 
choke point in this implementation.  There are a few resources online 
that talk about lock-free, work-stealing queues that aim to alleviate 
this, but they can be difficult to get right, and I wanted to first make
 sure I had a reliable implementation, even if it isn't absolutely as 
fast as possible.</p><p>In the example from the post, context switching 
should be minimal since I'm not oversaturating my physical cores, but in
 your case it could add to the execution time since several tasks could 
be contending for resources on the same core.</p><p>Dynamic memory 
allocation is another potential slowdown in the implementation from the 
post.  If you look in the ThreadPool.submit function, you'll see 
make_unique being called on the packaged task wrappers.  A potentially 
better solution would be to use a pre-allocated memory pool to fetch and
 return chunks of memory from as they're needed, but that was beyond the
 scope of this article.  In a production real-time application, this is a
 route I would explore further, especially as the number of tasks being 
submitted grew.</p><p>All of these items are trade-offs between 
complexity and performance gains.  For the application I'm working on, I
 have 3 large "main" tasks that run constantly (divvying up work inside 
frames to render) and the costs of the dynamic allocations and mutex 
uses pale in comparison to the performance improvements on CPU-bound 
scenes.  Long-running background tasks such as loading new textures in, 
etc., don't bother the workflow, and the main tasks can even spawn off 
sub-tasks pretty efficiently and still be a net gain for performance.</p><p>As with anything else - you have to profile and find the best solution for your project. :)</p><p>Edit:
  As far as the being C++14-specific stuff - the expanded use of 'auto' 
for return type deduction is a big help in keeping the implementation 
clean and easy to read.  I feel like template magic could get you most 
of the way there, but I haven't tried going that route.  (Also, 
make_unique is technically a C++14 feature, but I think VS has had it 
since 2013 if I recall correctly.)</p><p>-Will</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4fu"></li></ul></li><li class="realtime" data-role="realtime-notification:3319580154"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"></ul></li></ul></li></ul></li><li class="post" id="post-3319579991"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">Mohamed Samir</span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579991" data-role="relative-time" class="time-ago" title="Tuesday, August 23, 2016 9:55 AM">a year ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thank you for the information you provided in this post. I would like to mention that thread.join() is going to <br>hang the application exist on VS2013 because of this bug <br><a href="https://disq.us/url?url=https%3A%2F%2Fconnect.microsoft.com%2FVisualStudio%2Ffeedback%2Fdetails%2F747145%3ADTqnF-IcYgrhuFgrq13HokRQ_hg&amp;cuid=5140007" rel="nofollow noopener">https://connect.microsoft.c...</a></p><p>Apparently, thread::join() is being called after the main() function exists and this tries to run a mutex initialization<br>code after the main function ends.<br>a workaround as suggested on the provided link is to call windows API "_Cnd_do_broadcast_at_thread_exit()"<br>before creating any threads. This will ensure that mutexes are created before any object tries to access them <br>and also ensure that mutexes will live until the last moment of application life.</p><p>Cheers..Samir</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4bb"></li></ul></li><li class="realtime" data-role="realtime-notification:3319579991"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"></ul></li><li class="post" id="post-3319579999"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">Boris</span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579999" data-role="relative-time" class="time-ago" title="Wednesday, September 7, 2016 4:54 PM">a year ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thank you for the hard work on this!</p><p>How would I move a unique_ptr into this queue?</p><p>I tried the following:</p><p>auto taskFuture = DefaultThreadPool::submitJob(<br>	[](int _n, unique_ptr _message)<br>{<br>	doTask(_n, move(_message));<br>}, n, move(message));</p><p>But I get:</p><p>    Error C2672: 'std::invoke': no matching overloaded function found (1)</p><p>Do you have any suggestions?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4bj"></li></ul></li><li class="realtime" data-role="realtime-notification:3319579999"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"><li class="post" id="post-3319580022"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">WillP</span><span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579999" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Boris</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319580022" data-role="relative-time" class="time-ago" title="Tuesday, September 13, 2016 6:31 PM">a year ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hi,</p><p>An
 unfortunate result of using std::bind is that movable-only types aren't
 able to be passed easily if you're looking to transfer ownership 
(otherwise a const reference would suffice).</p><p>A sloppy way to do 
get around the limitation would be to change the lambda to take a raw 
pointer of your type and call release() on the original when submitting 
the task.  Then immediately wrap it back up in a unique_ptr inside the 
lambda body.  Again - sloppy and ugly, but it technically works, and 
from the body of the lambda you could move it elsewhere (your doTask 
function, for example).</p><p>C++ 17's std::apply (<a href="http://disq.us/url?url=http%3A%2F%2Fen.cppreference.com%2Fw%2Fcpp%2Futility%2Fapply%29%3AIQ4M2K2YBinP_mUpuU-d0NLga_E&amp;cuid=5140007" rel="nofollow noopener">http://en.cppreference.com/...</a> will likely be a better fit in the future, and it should allow move-only types to be used as expected.</p><p>Another potential solution you could explore is presented here:  <a href="http://disq.us/url?url=http%3A%2F%2Ftalesofcpp.fusionfenix.com%2Fpost-14%2Ftrue-story-moving-past-bind%3AvNHLPcaATYRw0LooscwHhA8NOFs&amp;cuid=5140007" rel="nofollow noopener">http://talesofcpp.fusionfen...</a></p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4c6"></li></ul></li><li class="realtime" data-role="realtime-notification:3319580022"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"></ul></li></ul></li><li class="post" id="post-3319579993"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">Aust</span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579993" data-role="relative-time" class="time-ago" title="Wednesday, November 30, 2016 12:48 PM">9 months ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container" style="height: 374px;"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hi,</p><p>I
 am having trouble using your example. I want to use it to do a single 
consumer thread that takes an input and process it and send an 
notification or a result to another thread.</p><p>Here is my code :<br>void Notify(int a){<br>    std::cout &lt;&lt; "Hello again" &lt;&lt; a &lt;&lt; std::endl;<br>}</p><p>class Tests{<br>public:<br>    void run(int a){<br>        std::this_thread::sleep_for(std::chrono::seconds(1));<br>        std::cout &lt;&lt; "Hello " &lt;&lt; a &lt;&lt; std::endl;</p><p>        DefaultThreadPool::submitJob([](int b)<br>        {<br>            Notify(b);<br>        }, a);<br>    }<br>};</p><p>int main( int argc, char* argv[] )<br>{<br>    auto i{0};<br>    Tests tests;</p><p>    while(true){<br>        DefaultThreadPool::submitJob([](Tests&amp; obj, int a)<br>        {<br>            <a href="http://disq.us/url?url=http%3A%2F%2Fobj.run%3AhX2u5HPXtkapowFaWvOJXYHBlis&amp;cuid=5140007" rel="nofollow noopener">obj.run</a>(a);<br>        },std::ref(tests), i);</p><p>        i++;<br>    }<br>    return 0;<br>}</p><p>I don't know if i am doing it right. It's like a cascading queue. But when I try to build it I have this error :<br>In file included from /src/<a href="http://disq.us/url?url=http%3A%2F%2Fmain_test.cc%3A96OOehJ3w4trnIhFOpvIFurf33I&amp;cuid=5140007" rel="nofollow noopener">main_test.cc</a>:2:0:<br>/src/ThreadPool.h: In function 'auto DefaultThreadPool::submitJob(Func&amp;&amp;, Args&amp;&amp; ...)':<br>/src/ThreadPool.h:222:30:
 error: there are no arguments to 'getThreadPool' that depend on a 
template parameter, so a declaration of 'getThreadPool' must be 
available [-fpermissive]<br>         return getThreadPool().submit(std::forward(func), std::forward(args)...);<br>                              ^<br>/src/ThreadPool.h:222:30:
 note: (if you use '-fpermissive', G++ will accept your code, but 
allowing the use of an undeclared name is deprecated)<br>src/CMakeFiles/test_thread.dir/build.make:62: recipe for target 'src/CMakeFiles/test_thread.dir/main_test.cc.o' failed</p><p>I am using G++ 5.4</p><p>Thanks for your help.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4bd"></li></ul></li><li class="realtime" data-role="realtime-notification:3319579993"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"><li class="post" id="post-3319580027"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">WillP</span><span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579993" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Aust</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319580027" data-role="relative-time" class="time-ago" title="Wednesday, December 7, 2016 11:10 AM">9 months ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Interesting,
 I'm running your example copy/pasted in VS2015 with no errors or 
warnings.  Are you enabling the c++14 flag for g++?  (g++-5.4.0 
-std=c++14 filename.cpp)</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4cb"></li></ul></li><li class="realtime" data-role="realtime-notification:3319580027"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"></ul></li></ul></li><li class="post" id="post-3319579990"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">Adam</span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579990" data-role="relative-time" class="time-ago" title="Saturday, December 3, 2016 12:03 PM">9 months ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hey WillP,</p><p>Thanks
 for the great threading article! I've started to have a play around 
with the code and I've run into an issue. If I submit a task from within
 a method and then try and fall out of that method whilst the long lived
 background task is underway then I get a hang at the end of the method.</p><p>This is caused by the m_future.get() line in the destructor which blocks the main (calling) thread.</p><p>Is
 this down to the fact that the future was created in the method and 
therefore the destructor gets called as the method goes out of scope 
which in turn blocks (because the future is still in use)? If so, is 
there any way I can work around this?</p><p>Thanks again!</p><p>Adam</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4ba"></li></ul></li><li class="realtime" data-role="realtime-notification:3319579990"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"><li class="post" id="post-3319580025"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">WillP</span><span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579990" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Adam</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319580025" data-role="relative-time" class="time-ago" title="Wednesday, December 7, 2016 11:17 AM">9 months ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hey Adam,<br>Yep,
 that was a design decision based on how I'm using the thread pool in my
 specific application.  If you don't want it to block when the future 
goes out of scope, you have a few options.  You can return the future to
 the calling method, store it somewhere else (std::move), or you could 
flesh the TaskFuture class out a little more and add a detach() method 
that could set a flag to check in the destructor before calling .get().<br>-Will</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4c9"></li></ul></li><li class="realtime" data-role="realtime-notification:3319580025"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"></ul></li></ul></li><li class="post" id="post-3319579996"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">interval</span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579996" data-role="relative-time" class="time-ago" title="Sunday, May 7, 2017 2:51 PM">4 months ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I
 have a slight bagaboo with your code &amp; example driver;  if your 
code is truly cross platform why not use a truly cross platform time 
keeping class. Rather than Timer, which is a windows-only class, use 
std::chrono for your time keeping methods. And in 
DefaultThreadPool::submitJob there is deprecated behavior; "there are no
 arguments to 'getThreadPool' that depend on a template parameter, so a 
declaration of 'getThreadPool' must be available", I bet this compiles 
fine on MSVC, right? MSVC is not a paragon of ISO/IEC 14882:2014 
behavior. In fact, it varies from the draft standard in many respects, 
unfortunately.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4bg"></li></ul></li><li class="realtime" data-role="realtime-notification:3319579996"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"><li class="post" id="post-3319580028"><div role="alert"></div><div data-role="post-content" class="post-content"><ul class="post-menu dropdown" data-role="menu"><li class="collapse"><a href="#" data-action="collapse" title="Collapse"><span></span></a></li><li class="expand"><a href="#" data-action="collapse" title="Expand"><span>+</span></a></li><li class="" role="menu"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="indicator"></div><div class="avatar"><div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span class="author">WillP</span><span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319579996" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> interval</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true"></span> <a href="http://roar11.com/2016/01/a-platform-independent-thread-pool-using-c14/#comment-3319580028" data-role="relative-time" class="time-ago" title="Sunday, May 7, 2017 6:29 PM">4 months ago</a></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container" style="height: 374px;"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>The
 Timer class is part of my project, not a MS thing (although they may 
have something named Timer, too).  I didn't specify details about it 
since it wasn't the focus of the article, but it's implemented using 
types found in the chrono header.  The tick function is:<br>[code language="cpp"]<br>double Timer::tick(void)<br>{<br>	m_currentTime = std::chrono::high_resolution_clock::now();<br>	m_timeElapsed = (m_currentTime - m_lastTime).count() * m_timeScale;<br>	m_lastTime = m_currentTime;<br>	return m_timeElapsed;<br>}<br>[/code]</p><p>Regarding
 the 'there are no arguments...' portion, there are two potential 
issues.  First, I should define getThreadPool before submitJob.  Second,
 the fully-qualified type name should be used, or there should be a 
'using' directive before it.  For example,<br>[code language="cpp"]<br>MyNamespace::DefaultThreadPool::submitJob...<br>[/code]</p><p>or</p><p>[code language="cpp"]<br>using MyNamespace;<br>DefaultThreadPool::submitJob...<br>[/code]</p><p>I
 should have specified that in the example, but that portion was meant 
to be a very basic demonstration of usage and I got lazy on 
copy/pasting.  I've updated the code in the article to reflect these 
items.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a> <span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span></span></div></li><li class="bullet" aria-hidden="true"></li><li class="reply" data-role="reply-link"><a href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true"></li><li class="comment__share"><a class="toggle"><span class="text">Share </span></a><ul class="comment-share__buttons"><li class="twitter"><button class="share__button" data-action="share:twitter">Twitter</button></li><li class="facebook"><button class="share__button" data-action="share:facebook">Facebook</button></li><li class="link"><input class="share__button" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1iwe4cc"></li></ul></li><li class="realtime" data-role="realtime-notification:3319580028"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><ul data-role="children" class="children"></ul></li></ul></li></ul><div class="load-more" data-role="more" style="display: none;"><a href="#" data-action="more-posts" class="btn load-more__button">Load more comments</a></div></div></section><div id="placement-bottom" data-tracking-area="discovery-south"><div class="post-list" style="height: 0px; visibility: hidden;"></div></div><div id="footer" data-tracking-area="footer" class="disqus-footer__wrapper"><ul class="disqus-footer"><li class="disqus-footer__logo"><a href="https://disqus.com/" rel="nofollow" title="Powered by Disqus" class="disqus-footer__link">Powered by Disqus</a></li><li id="thread-subscribe-button" class="email disqus-footer__item"><div class="default"><a href="#" rel="nofollow" data-action="subscribe" title="Subscribe and get email updates from this discussion" class="disqus-footer__link"><i aria-hidden="true" class="icon icon-mail"></i><span class="clip">Subscribe</span><i aria-hidden="true" class="icon icon-checkmark"></i></a></div></li><li class="install disqus-footer__item"><a href="https://publishers.disqus.com/engage?utm_source=roar11-com&amp;utm_medium=Disqus-Footer" rel="nofollow" target="_blank" class="disqus-footer__link"><i aria-hidden="true" class="icon icon-disqus"></i><span class="clip hidden-sm">Add Disqus to your site</span><span class="clip visible-sm hidden-xs">Add Disqus</span><span class="clip visible-xs">Add</span></a></li><li class="privacy disqus-footer__item"><a href="https://help.disqus.com/customer/portal/articles/466259-privacy-policy" rel="nofollow" target="_blank" class="disqus-footer__link"><i aria-hidden="true" class="icon icon-lock"></i><span class="clip">Privacy</span></a></li></ul></div></div><iframe style="position: absolute; width: 1px; height: 1px; left: -9999px; display: none;" aria-hidden="true" id="ssIFrame_google" sandbox="allow-scripts allow-same-origin" src="a_data/iframe.html"></iframe><div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_https" allowtransparency="true" allowfullscreen="true" scrolling="no" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" style="border: medium none;" src="a_data/0sTQzbapM8j.html" frameborder="0"></iframe></div></div></div><img style="display: none !important;" src="a_data/23096.gif" hidden=""><img style="display: none !important;" src="a_data/a_002.html" hidden=""><iframe style="display: none !important;" src="//pippio.com/api/sync?pid=1391&amp;ref=http%3A%2F%2Froar11.com%2F2016%2F01%2Fa-platform-independent-thread-pool-using-c14%2F&amp;it=1&amp;iv=c3jb96en3bjktm3" hidden=""></iframe><img style="display: none !important;" src="a_data/a.gif" hidden=""><img style="display: none !important;" src="a_data/g.gif" hidden=""></body></html>